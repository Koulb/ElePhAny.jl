# [Electron-Phonon Coupling – Theory Recap](@id theory)

## Effective Potential Expansion and E–ph Hamiltonian

When atoms vibrate from their equilibrium positions, the electronic effective potential changes. This gives rise to an electron–phonon interaction Hamiltonian that can be written as: 

$$\hat{H}^{\mathrm{e\text{-}ph}} \;=\; \sum_{\kappa,\alpha,l} \frac{\partial \hat{V}}{\partial \tau_{\kappa\alpha l}}\;\delta \tau_{\kappa\alpha l},$$

where $\hat{V}$ is the effective potential, and $\tau_{\kappa\alpha l}$ denotes the $\alpha$-component of the position of atom $\kappa$ in the unit cell at lattice vector $\mathbf{R}_l$. 

---

## Electron-Phonon Matrix Element Definition

The **electron–phonon (e–ph) matrix element** $g_{mn\nu}(\mathbf{k},\mathbf{q})$ represents the probability amplitude for an electron in an initial Bloch state $| \psi_{n,\mathbf{k}}\rangle$ to scatter into a final state $| \psi_{m,\mathbf{k+q}}\rangle$ by interacting with a phonon of branch $\nu$ and wavevector $\mathbf{q}$:

$$g_{mn\nu}(\mathbf{k},\mathbf{q}) \;=\; \sum_{\kappa,\alpha} \sqrt{\frac{\hbar}{2 M_\kappa \,\omega_{\mathbf{q}\nu}}}\; e_{\kappa\alpha,\mathbf{q}\nu} \;\Big\langle \psi_{m,\mathbf{k+q}}\Big| \frac{\partial V}{\partial \tau_{\kappa\alpha}} \Big|\psi_{n,\mathbf{k}}\Big\rangle,$$

with $M_\kappa$ the atomic mass, $\omega_{\mathbf{q}\nu}$ the phonon frequency, and $e_{\kappa\alpha,\mathbf{q}\nu}$ the phonon eigenvector.

---

## Motivation: Challenges with Finite Differences

Since the DFPT method currently doesn't allow us to get any functionals of interest (e.g, Hybrids), we could use a general finite difference approach. Even though a simple finite difference formula could obtain the derivative of the potential $\partial V$, there are cases where it is challenging to do so: 

- **Nonlocal part of the potential** in pseudopotential form require special treatment.  
- **Beyond-DFT methods** (hybrids, Koopmans, $GW$) include orbital-dependent nonlocal operators, which forces to save different potentials for different orbitals.  

---

## Eigenvalue-Based Projectability Approach

Instead of explicitly evaluating $\partial V$, we rewrite the derivative in the form of the derivative of the Hamiltonian:

$$\frac{\partial \hat{H}}{\partial \tau_{\kappa\alpha}} \;\approx\; \frac{\hat{H}(+\Delta\tau) - \hat{H}(-\Delta\tau)}{2\,\Delta\tau}~.$$

Inserting the identity $\sum_j |\psi_j^\pm\rangle \langle\psi_j^\pm|$ with wave functions of the displaced systems gives:

$$\Big\langle \psi_{m,\mathbf{k+q}}\Big| \frac{\partial V}{\partial \tau_{\kappa\alpha}}\Big| \psi_{n,\mathbf{k}}\Big\rangle \;\approx\; 
\frac{1}{2\Delta\tau}\!
\sum_{j}^{N^{\rm max}}
\Big(\varepsilon_j^+\, u^{+*}_{m\mathbf{k+q},j}u^{+}_{j,n\mathbf{k}}
-\varepsilon_j^-\, u^{-*}_{m\mathbf{k+q},j}u^{-}_{j,n\mathbf{k}}\Big),$$

where $u^{\pm}_{j,n\mathbf{k}}=\langle \psi_j^\pm | \psi_{n,\mathbf{k}}\rangle$ are overlap coefficients.

**Advantages:**
- Works for any pseudopotential or functional (DFT and beyond).  
- Requires only eigenvalues and eigenvectors of pristine and displaced systems.  
- Automatically yields $g_{mn\nu}$ for $\mathbf{k}$ and $\mathbf{q}$ points commensurate with the supercell.  

---

## Approximations

- **Finite difference step:** requires convergence with respect to $\Delta\tau$.  
- **Truncated basis:** the completeness of the identity is approximated with $N^{\rm max}$ states; small size of the perturbation ensures accuracy.  

---

## Symmetry Reduction

The number of displacements can be reduced from $3N^{\rm at}$ to $N^{\rm in}$ by using space-group symmetries.  
- Only inequivalent atoms and directions need to be displaced.  
- Wavefunctions for equivalent displacements are generated by symmetry transformations.  

